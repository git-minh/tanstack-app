# Task ID: 45
# Title: Design Reference CRUD Operations
# Status: pending
# Dependencies: 41, 44
# Priority: medium
# Description: Build backend queries and mutations for design reference management
# Details:
Create packages/backend/convex/designReferences.ts with complete CRUD: getDesignReferences query (list with pagination, filter by style/tags, sort by updatedAt), getDesignReference query (single by ID or displayId), createDesignReference mutation (save analysis and prompts), updateDesignReference mutation (edit tags, description, style), deleteDesignReference mutation, searchDesignReferences query (search by URL, site name, tags). Implement authentication checks on all operations. Use requireAuth helper pattern. Add comprehensive error handling. Estimated time: 1.5 hours.

# Test Strategy:
Test all CRUD operations, verify auth enforcement, test filtering and search, test pagination with 20+ references, verify ownership validation, test error cases

# Subtasks:
## 1. Create designReferences.ts file structure [pending]
### Dependencies: None
### Description: Set up Convex file with imports and requireAuth helper
### Details:
Create file, import query/mutation/v/Id, add requireAuth helper function

## 2. Implement getDesignReferences query [pending]
### Dependencies: 45.1
### Description: List user's references with pagination and filtering
### Details:
Query with limit, style, tag args. Use by_userId or by_userId_and_style index. Filter and sort by updatedAt.

## 3. Implement getDesignReference query [pending]
### Dependencies: 45.1
### Description: Fetch single reference by ID with ownership check
### Details:
Query by id, verify ownership, return complete reference

## 4. Implement createDesignReference mutation [pending]
### Dependencies: 45.1
### Description: Save new design reference after analysis
### Details:
Generate displayId, insert with all fields, return id

## 5. Implement update and delete mutations [pending]
### Dependencies: 45.1
### Description: Edit tags/description and delete references
### Details:
updateDesignReference: verify ownership, patch. deleteDesignReference: verify ownership, delete.

## 6. Implement searchDesignReferences query [pending]
### Dependencies: 45.1
### Description: Search by URL, name, or tags
### Details:
Case-insensitive search across url, siteName, tags fields

## 7. Test all CRUD with auth and edge cases [pending]
### Dependencies: 45.2, 45.3, 45.4, 45.5, 45.6
### Description: Comprehensive testing of all operations
### Details:
Test create, pagination, filtering, search, update, auth enforcement, delete, missing fields

