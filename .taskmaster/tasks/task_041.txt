# Task ID: 41
# Title: Database Schema for Design References
# Status: done
# Dependencies: None
# Priority: high
# Description: Create designReferences table with comprehensive analysis and prompt storage
# Details:
Update convex/schema.ts to add designReferences table with fields: userId, displayId, url, siteName, description, analysis object (uiPatterns, colorPalette, typography, techStack, components), clonePrompts object (fullPage, components[], designSystem), tags[], style, industry, thumbnail, createdAt, updatedAt. Add indexes: by_userId, by_displayId, by_userId_and_style. Update convex/counters.ts to add 'designReferences': 'DR' prefix mapping for display ID generation. Estimated time: 1 hour.

# Test Strategy:
Verify schema compiles, test display ID generation (DR-000001), verify indexes created in Convex dashboard, test schema accepts all field types

# Subtasks:
## 1. Define designReferences table schema [done]
### Dependencies: None
### Description: Add designReferences table definition to convex/schema.ts with all required fields
### Details:
Define table with fields: userId (string), displayId (string), url (string), siteName (string), description (optional string), analysis object with nested structure (uiPatterns array, colorPalette object with primary/secondary/accent arrays, typography object with headingFont/bodyFont/sizes, techStack array, components array of objects), clonePrompts object (fullPage string, components array, designSystem string), tags array, style string, industry optional string, thumbnail optional string, createdAt number, updatedAt number. Use v.object(), v.array(), v.optional() appropriately.

## 2. Add table indexes for efficient querying [done]
### Dependencies: 41.1
### Description: Add indexes to designReferences table for user queries, displayId lookup, and style filtering
### Details:
Add three indexes using .index() method: by_userId on userId field for listing user's references, by_displayId on displayId for unique lookups (DR-000001), by_userId_and_style on [userId, style] for filtered queries. Verify index syntax matches existing patterns in schema.ts.

## 3. Update counters.ts with DR prefix mapping [done]
### Dependencies: None
### Description: Add designReferences counter prefix to generate display IDs like DR-000001
### Details:
Open packages/backend/convex/counters.ts and add 'designReferences': 'DR' to the prefixes object in generateDisplayId function. Follow existing pattern used for tasks (TD), contacts (CT), projects (PR), chatSessions (CH).

## 4. Test schema compilation and verify in Convex dashboard [done]
### Dependencies: 41.1, 41.2, 41.3
### Description: Run dev server and verify schema compiles, indexes created, displayId generation works
### Details:
Run pnpm dev to trigger Convex schema push. Check terminal for compilation errors. Open Convex dashboard and verify designReferences table exists with all fields and 3 indexes. Test generateDisplayId with 'designReferences' parameter returns DR-000001 format.

