# Development Setup

This guide covers how to set up and run the TanStack application in development mode.

## Prerequisites

- **Node.js** v18 or higher
- **pnpm** package manager
- **Git** for version control

## Installation

### 1. Clone the Repository
```bash
git clone <repository-url>
cd tanstack-app
```

### 2. Install Dependencies
```bash
pnpm install
```

This will install dependencies for all workspaces using the version catalog defined in `pnpm-workspace.yaml`.

## Development Commands

### Starting Development Servers

#### Option 1: Start All Services (Recommended)
```bash
pnpm dev
```
This starts both frontend and backend concurrently using Turborepo.

#### Option 2: Start Frontend Only
```bash
pnpm dev:web
```
Starts the frontend development server on port 3001.

#### Option 3: Start Backend Only
```bash
pnpm dev:server
```
Starts the Convex backend development server.

#### Option 4: Initial Backend Setup
```bash
pnpm dev:setup
```
Runs the Convex initial setup and configuration.

### Other Development Commands

```bash
# Build all packages
pnpm build

# Type checking across all packages
pnpm check-types

# Native development (if applicable)
pnpm dev:native
```

## Environment Variables

### Frontend Environment (apps/web)

Create `apps/web/.env.local` for frontend-specific variables:

```env
# Convex connection
VITE_CONVEX_URL=https://your-project.convex.cloud
VITE_CONVEX_SITE_URL=https://your-project.convex.site

# Other frontend variables
VITE_APP_NAME=Your App Name
```

### Backend Environment (packages/backend)

Create `packages/backend/.env.local` for backend-specific variables:

```env
# Convex deployment
CONVEX_DEPLOYMENT=dev:your-project-id
CONVEX_URL=https://your-project.convex.cloud

# URLs
SITE_URL=http://localhost:3001
CONVEX_SITE_URL=https://your-project.convex.site

# Authentication
BETTER_AUTH_SECRET=your-secret-key
```

## File Structure

```
tanstack-app/
├── apps/
│   └── web/
│       ├── src/
│       │   ├── components/    # React components
│       │   ├── lib/           # Utility functions
│       │   ├── routes/        # File-based routes
│       │   └── index.css      # Global styles
│       ├── components.json    # shadcn/ui config
│       ├── vite.config.ts    # Vite configuration
│       ├── wrangler.jsonc     # Cloudflare config
│       └── package.json       # Frontend dependencies
├── packages/
│   └── backend/
│       └── convex/
│           ├── *.ts           # Convex functions
│           ├── auth.ts        # Authentication
│           └── schema.ts      # Database schema
├── docs/                      # Documentation
├── package.json               # Root scripts
├── pnpm-workspace.yaml        # Workspace configuration
└── turbo.json                 # Turborepo configuration
```

## Development Workflow

### 1. Code Organization

- **Frontend**: Located in `apps/web/src/`
  - `routes/` - File-based routing (TanStack Router)
  - `components/` - React components
  - `lib/` - Utility functions and configurations

- **Backend**: Located in `packages/backend/convex/`
  - `*.ts` files - Convex functions (queries, mutations, actions)
  - `schema.ts` - Database schema definition
  - `auth.ts` - Authentication configuration

### 2. Adding New Routes

1. Create a file in `apps/web/src/routes/` with the pattern `route-name.tsx`
2. Export a component as the default export
3. Run the development server to generate types

### 3. Database Changes

1. Modify `packages/backend/convex/schema.ts` for schema changes
2. Create/update Convex functions in the same directory
3. Changes are automatically synced to development deployment

### 4. UI Components

1. Use the configured shadcn/ui components
2. Components are located in `apps/web/src/components/ui/`
3. Follow the established patterns for new components

## Code Generation

This project uses automatic code generation:

- **Route Types**: Generated by TanStack Router
- **Convex Types**: Generated by Convex CLI
- **API Types**: Generated from Convex schema

### Generated Files

- `apps/web/src/routeTree.gen.ts` - Route type definitions
- `packages/backend/convex/_generated/` - Convex generated types and API

These files should be committed to version control.

## Testing

Run tests using the configured test runner:

```bash
# Run all tests
pnpm test

# Run tests with coverage
pnpm test:coverage
```

## Linting and Formatting

```bash
# Lint all packages
pnpm lint

# Fix linting issues
pnpm lint:fix

# Format code
pnpm format
```

## Common Issues

### Environment Variables Not Loading
- Ensure `.env.local` files are in the correct directories
- Restart the development server after changing environment variables
- Check that variable names match the expected prefixes (`VITE_*` for frontend)

### Convex Connection Issues
- Verify `CONVEX_URL` and `VITE_CONVEX_URL` match
- Run `pnpm dev:setup` to reconfigure Convex
- Check Convex deployment status in the dashboard

### Build Errors
- Clear `.turbo` cache directories
- Delete `node_modules` and run `pnpm install`
- Check TypeScript types with `pnpm check-types`
